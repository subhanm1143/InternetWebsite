<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compare Providers</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/compareProviders.css">
    <link href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>
</head>
<body>
    <!-- Header Navigation -->
    <header class="main-header">
        <div class="logo">
            <a href="index.html"><img src="imgs/Logo.png" alt="Logo"></a>
        </div>
        <nav class="main-nav">
            <ul>
                <li><a href="compareProviders.html">Compare Providers</a></li>
                <li><a href="reviewProviders.html">Review Providers</a></li>
                <li><a href="resources.html">Resources</a></li>
            </ul>
        </nav>
        <div class="search-bar-container">
            <input type="text" id="search-input" placeholder="Search pages..." class="search-input">
            <ul id="search-results" class="search-results"></ul>
        </div>
    </header>

    <main>
        <section class="search-section">
            <div class="container">
                <h1>Search Internet Providers by Zip Code</h1>
                <p>
                    Weâ€™ve built a comprehensive database of all the internet service providers across the United States.
                </p>
                <p>Enter your zip code to find the best internet providers near you.</p>
                <div class="search-box">
                    <input type="text" id="zip-code-input" placeholder="Zip code" class="zip-input">
                    <button id="search-button" class="search-button">Search Providers</button>
                </div>
            </div>
        </section>

        <section class="results-section">
            <div class="container">
                <h2>Broadband Data Results</h2>
                <div id="zip-display">
                    <!-- Display ZIP code here -->
                </div>
                <div class="result-container">
                    <div id="broadband-info"></div>
                    <table class="broadband-data-table">
                        <tbody id="broadband-info">
                            <!-- Dynamic content will go here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </section>
    </main>

    <footer class="footer">
        <div class="footer-container">
          <div class="footer-column">
            <h3>Providers</h3>
            <ul>
              <li><a href="compareProviders.html">Compare Providers</a></li>
              <li><a href="reviewProviders.html">Review Providers</a></li>
            </ul>
          </div>
          <div class="footer-column">
            <h3>Internet Tools</h3>
            <ul>
              <li><a href="speed.html">Internet Speed Test</a></li>
              <li><a href="speedCalculator.html">How Much Speed Do You Need?</a></li>
            </ul>
          </div>
          <div class="footer-column">
            <h3>Connect with Us</h3>
            <ul>
              <li><a href="about.html">About</a></li>
              <li><a href="contact.html">Contact Us</a></li>
            </ul>
            <div class="social-icons">
              <a href="#"><i class="fab fa-facebook-f"></i></a>
              <a href="#"><i class="fab fa-twitter"></i></a>
              <a href="#"><i class="fab fa-instagram"></i></a>
            </div>
          </div>
        </div>
              <!-- Chat Button and Iframe -->
    <div id="chat-button" onclick="toggleChatBox()" style="
    position: fixed; 
    bottom: 20px; 
    right: 20px; 
    background-color: #0056d4; 
    color: #fff; 
    border-radius: 50%; 
    width: 60px; 
    height: 60px; 
    display: flex; 
    align-items: center; 
    justify-content: center; 
    cursor: pointer; 
    z-index: 1100;">
    <i class="fas fa-comments" style="font-size: 24px;"></i>
    </div>

    <iframe 
    src="chatbox.html" 
    id="chat-box-frame" 
    style="
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: 360px;
        height: 500px;
        border: none;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        display: none; /* Initially hidden */
        z-index: 1000;">
    </iframe>

<script>
    // Function to toggle the iframe visibility
    function toggleChatBox() {
        const chatFrame = document.getElementById('chat-box-frame');
        
        if (chatFrame.style.display === 'none') {
            // Open the chat box
            chatFrame.style.display = 'block';
        } else {
            // Close the chat box
            chatFrame.style.display = 'none';
            
            // Reset the chat box content by reloading the iframe
            chatFrame.src = chatFrame.src;
        }
    }
</script>

      </footer>

      <script>
        let totalSpeed = 0;
        
        // Normalize Speed Function
        function normalizeSpeed(speedStr) {
            if (speedStr.toLowerCase().includes("gig")) {
                return parseFloat(speedStr) * 1000;
            } else if (speedStr.toLowerCase().includes("mbps")) {
                return parseFloat(speedStr);
            }
            return NaN;
        }

        // Load Broadband Data
        async function loadBroadbandData() {
            const response = await fetch('broadband_data.csv');
            const data = await response.text();

            const rows = data.split('\n').slice(1);
            return rows.map(row => {
                const columns = row.split(',');
                if (columns.length >= 10) {
                    return {
                        planName: columns[0].trim(),
                        speed: normalizeSpeed(columns[1].trim()),
                        price: columns[2].trim(),
                        providerLogo: columns[8].trim(),
                        rating: parseFloat(columns[9].trim()),
                        connectionType: columns[10].trim()
                    };
                }
                return null;
            }).filter(plan => plan && !isNaN(plan.speed));
        }

        // Display Recommended Plans
        async function displayRecommendedPlans(recommendedSpeed) {
            const broadbandInfo = document.getElementById('plan-list');
            broadbandInfo.innerHTML = '';

            const broadbandData = await loadBroadbandData();
            const filteredPlans = broadbandData.filter(plan =>
                Math.abs(plan.speed - recommendedSpeed) <= 500
            );

            if (filteredPlans.length === 0) {
                broadbandInfo.innerHTML = '<p>No plans found within this range.</p>';
                return;
            }

            broadbandInfo.innerHTML = filteredPlans
                .map(entry => `
                    <div class="provider-card" data-aos="fade-up">
                        <div class="provider-card-header">
                            <h3>${entry.planName}</h3>
                            <p><img src="${entry.providerLogo}" alt="Provider Logo"></p>
                        </div>
                        <div><strong>Speed:</strong> ${entry.speed} Mbps</div>
                        <div><strong>Price:</strong> ${entry.price}</div>
                        <div><strong>Rating:</strong> ${entry.rating}</div>
                    </div>`).join('');
        }

        function selectAnswer(step, value) {
            totalSpeed += value;
            document.querySelector(`.question[data-step="${step}"]`).classList.add('hidden');

            const nextQuestion = document.querySelector(`.question[data-step="${step + 1}"]`);
            if (nextQuestion) {
                nextQuestion.classList.remove('hidden');
            } else {
                document.querySelector('.result').classList.remove('hidden');
                document.getElementById('recommended-speed').textContent = `${totalSpeed} Mbps`;
                displayRecommendedPlans(totalSpeed);
            }
        }
    </script>
    <script>AOS.init();</script>
</body>
</html>